[{"_path":"/nuxt3/features/shared-state","_dir":"features","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"状态共享","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"状态共享"},"children":[{"type":"text","value":"状态共享"}]},{"type":"element","tag":"h2","props":{"id":"基础"},"children":[{"type":"text","value":"基础"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useState"}]},{"type":"text","value":" 可以定义简单的共享状态"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"例如在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"composables"}]},{"type":"text","value":" 中定义 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useCounter"}]}]},{"type":"element","tag":"code","props":{"code":"// composables/useCounter.ts\n// composables 下模块的同名导出将被自动按需引入\nexport const useCounter = () => useState('counter', () => 100)\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// composables/useCounter.ts\n// composables 下模块的同名导出将被自动按需引入\nexport const useCounter = () => useState('counter', () => 100)\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useState"}]},{"type":"text","value":" 的第一参数为 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"key"}]},{"type":"text","value":"，第二参数为初始化的工厂函数"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"此时在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"index"}]},{"type":"text","value":" 页面中可以直接使用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useCounter"}]}]},{"type":"element","tag":"code","props":{"code":"<!-- pages/index.vue -->\n<script lang=\"ts\" setup>\n    const conuter = useCounter() // 这是按需自动引入的\n</script>\n\n<template>\n    <div> <!-- 顶层的 div 包裹是必需的，不然跳转会丢失状态 -->\n        <div @click=\"conuter++\">{{ conuter }}</div>\n        <NuxtLink to=\"/home\">to home</NuxtLink>\n    </div>\n</template>\n","language":"html"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"<!-- pages/index.vue -->\n<script lang=\"ts\" setup>\n    const conuter = useCounter() // 这是按需自动引入的\n</script>\n\n<template>\n    <div> <!-- 顶层的 div 包裹是必需的，不然跳转会丢失状态 -->\n        <div @click=\"conuter++\">{{ conuter }}</div>\n        <NuxtLink to=\"/home\">to home</NuxtLink>\n    </div>\n</template>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"home"}]},{"type":"text","value":" 页面中也可以直接使用"}]},{"type":"element","tag":"code","props":{"code":"<!-- pages/home.vue -->\n<script lang=\"ts\" setup>\n    const conuter = useCounter()\n</script>\n\n<template>\n    <div @click=\"conuter++\">{{ conuter }}</div>\n</template>\n","language":"html"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"<!-- pages/home.vue -->\n<script lang=\"ts\" setup>\n    const conuter = useCounter()\n</script>\n\n<template>\n    <div @click=\"conuter++\">{{ conuter }}</div>\n</template>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"你会发现两个页面的状态是共享的 👍"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"注意"},"children":[{"type":"text","value":"注意"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"useState"}]},{"type":"text","value":" 只允许在生命周期中使用。"}]}]},"_type":"markdown","_id":"content:2.nuxt3:2.features:shared-state.md","_source":"content","_file":"2.nuxt3/2.features/shared-state.md","_extension":"md"},{"_path":"/vite/plugins/use-modules","_dir":"plugins","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"模块自动加载","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"模块自动加载"},"children":[{"type":"text","value":"模块自动加载"}]},{"type":"element","tag":"h2","props":{"id":"仓库"},"children":[{"type":"text","value":"仓库"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"模块自动加载插件 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"npm"}]},{"type":"text","value":" 包已实现，具体可见该仓库 👉 "},{"type":"element","tag":"a","props":{"href":"https://github.com/dishait/vite-plugin-use-modules","rel":["nofollow"]},"children":[{"type":"text","value":"vite-plugin-use-modules"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"原理"},"children":[{"type":"text","value":"原理"}]},{"type":"element","tag":"h3","props":{"id":"glob-导入"},"children":[{"type":"element","tag":"a","props":{"href":"https://cn.vitejs.dev/guide/features.html#glob-import","rel":["nofollow"]},"children":[{"type":"text","value":"Glob 导入"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"vite"}]},{"type":"text","value":" 中有个非常好用的功能叫做 "},{"type":"element","tag":"a","props":{"href":"https://cn.vitejs.dev/guide/features.html#glob-import","rel":["nofollow"]},"children":[{"type":"text","value":"Glob 导入"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"例如你可以通过下边的方式自动引入 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"src/modules"}]},{"type":"text","value":" 下的所有 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"js"}]},{"type":"text","value":" 模块"}]},{"type":"element","tag":"code","props":{"code":"const modules = import.meta.globEager(\n    '/src/modules/**/*.js'\n)\n\nconsole.log(modules) // 将以对象的方式输出到前端控制台\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const modules = import.meta.globEager(\n    '/src/modules/**/*.js'\n)\n\nconsole.log(modules) // 将以对象的方式输出到前端控制台\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Glob 导入","src":"/quick/img/globEager.gif"},"children":[]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"自动注册"},"children":[{"type":"text","value":"自动注册"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"根据上边的原理，我们就可以自动注册 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"vue"}]},{"type":"text","value":" 模块"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"例如注册 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pinia"}]}]},{"type":"element","tag":"code-group","props":{},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"codegroupitem","props":{"title":"npm","active":""},"children":[{"type":"element","tag":"code","props":{"code":"npm i pinia -D\n","language":"shell"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm i pinia -D\n"}]}]}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "},{"type":"element","tag":"codegroupitem","props":{"title":"yarn"},"children":[{"type":"element","tag":"code","props":{"code":"yarn add pinia -D\n","language":"shell"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"yarn add pinia -D\n"}]}]}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "},{"type":"element","tag":"codegroupitem","props":{"title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"pnpm add pinia -D\n","language":"shell"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"pnpm add pinia -D\n"}]}]}]},{"type":"text","value":"\n  "}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然后创建模块 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"src/modules/pinia.js"}]}]},{"type":"element","tag":"code","props":{"code":"// src/modules/pinia.js\nimport { createPinia } from 'pinia'\n\nexport default app => app.use(createPinia())\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// src/modules/pinia.js\nimport { createPinia } from 'pinia'\n\nexport default app => app.use(createPinia())\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然后在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"src/main.js"}]},{"type":"text","value":" 下书写以下代码"}]},{"type":"element","tag":"code","props":{"code":"import App from './App.vue'\nimport { createApp } from 'vue'\n\nconst app = createApp(App)\n\n// 引入所有模块\nconst modules = import.meta.globEager(\n    '/src/modules/**/*.js'\n)\n// 安装插件\nObject.values(modules).forEach(module => {\n    if (typeof module.default === 'function') {\n        module.default(app)\n    }\n})\n\napp.mount('#app')\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import App from './App.vue'\nimport { createApp } from 'vue'\n\nconst app = createApp(App)\n\n// 引入所有模块\nconst modules = import.meta.globEager(\n    '/src/modules/**/*.js'\n)\n// 安装插件\nObject.values(modules).forEach(module => {\n    if (typeof module.default === 'function') {\n        module.default(app)\n    }\n})\n\napp.mount('#app')\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以上就算自动注册 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pinia"}]},{"type":"text","value":" 成功了，可以创建 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"src/stores/counter.js"}]},{"type":"text","value":" 验证一下"}]},{"type":"element","tag":"code","props":{"code":"// src/stores/counter.js\nimport { defineStore } from 'pinia'\n\nexport const useCounterStore = defineStore('counter', {\n    state() {\n        return {\n            counter: 0\n        }\n    },\n    actions: {\n        inc() {\n            this.counter++\n        }\n    }\n})\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// src/stores/counter.js\nimport { defineStore } from 'pinia'\n\nexport const useCounterStore = defineStore('counter', {\n    state() {\n        return {\n            counter: 0\n        }\n    },\n    actions: {\n        inc() {\n            this.counter++\n        }\n    }\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后就可以在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"src/App.vue"}]},{"type":"text","value":" 中使用了"}]},{"type":"element","tag":"code","props":{"code":"<script setup>\n    import { useCounterStore } from './stores/counter'\n\n    const store = useCounterStore()\n</script>\n\n<template>\n    <div @click=\"store.inc()\">{{ store.counter }}</div>\n</template>\n","language":"html"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"<script setup>\n    import { useCounterStore } from './stores/counter'\n\n    const store = useCounterStore()\n</script>\n\n<template>\n    <div @click=\"store.inc()\">{{ store.counter }}</div>\n</template>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"自动注册","src":"/quick/img/autoUse.gif"},"children":[]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"虚拟模块"},"children":[{"type":"element","tag":"a","props":{"href":"https://cn.vitejs.dev/guide/api-plugin.html#importing-a-virtual-file","rel":["nofollow"]},"children":[{"type":"text","value":"虚拟模块"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我们都知道 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"vite"}]},{"type":"text","value":" 插件里有个非常好用的虚拟文件或者虚拟模块功能"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"例如我们可以创建一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/foo.js"}]},{"type":"text","value":" 插件"}]},{"type":"element","tag":"code","props":{"code":"// plugins/foo.js\n// 虚拟模块 id\nconst virtualModuleId = 'msg'\n// 处理之后的虚拟模块 id\nconst resolvedVirtualModuleId = '\\0' + virtualModuleId\n// 虚拟模块代码\nconst code = `export default 100`\n\nexport default {\n    name: 'foo',\n    resolveId(id) {\n        if (id === virtualModuleId) {\n            return resolvedVirtualModuleId\n        }\n    },\n    load(id) {\n        if (id === resolvedVirtualModuleId) {\n            return code\n        }\n    }\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// plugins/foo.js\n// 虚拟模块 id\nconst virtualModuleId = 'msg'\n// 处理之后的虚拟模块 id\nconst resolvedVirtualModuleId = '\\0' + virtualModuleId\n// 虚拟模块代码\nconst code = `export default 100`\n\nexport default {\n    name: 'foo',\n    resolveId(id) {\n        if (id === virtualModuleId) {\n            return resolvedVirtualModuleId\n        }\n    },\n    load(id) {\n        if (id === resolvedVirtualModuleId) {\n            return code\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然后我们需要注册该插件"}]},{"type":"element","tag":"code","props":{"code":"import { defineConfig } from 'vite'\nimport vue from '@vitejs/plugin-vue'\nimport foo from './plugins/foo'\n\nexport default defineConfig({\n    plugins: [vue(), foo]\n})\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import { defineConfig } from 'vite'\nimport vue from '@vitejs/plugin-vue'\nimport foo from './plugins/foo'\n\nexport default defineConfig({\n    plugins: [vue(), foo]\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后就可以在前端里引入该虚拟模块了，例如 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"src/main.js"}]},{"type":"text","value":" 中"}]},{"type":"element","tag":"code","props":{"code":"// ...\nimport msg from 'msg'\n\nconsole.log(msg) // 将在前端控制台输出 100\n// ...\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// ...\nimport msg from 'msg'\n\nconsole.log(msg) // 将在前端控制台输出 100\n// ...\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"虚拟模块","src":"/quick/img/virtualModule.gif"},"children":[]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"实现"},"children":[{"type":"text","value":"实现"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"同理，我们也可以创建携带 "},{"type":"element","tag":"a","props":{"href":"https://cn.vitejs.dev/guide/features.html#glob-import","rel":["nofollow"]},"children":[{"type":"text","value":"Glob 导入"}]},{"type":"text","value":" 实现自动注册 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"vue"}]},{"type":"text","value":" 模块的代码"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先创建 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"plugins/use-modules.js"}]},{"type":"text","value":" 插件"}]},{"type":"element","tag":"code","props":{"code":"export default () => {\n    const virtualModuleId = 'virtual:modules'\n    const resolvedVirtualModuleId = '\\0' + virtualModuleId\n\n    const code = `\nexport const modules = import.meta.globEager(\n    '/src/modules/**/*.js'\n)\n\nexport const useModules = app => {\n    Object.values(modules).forEach(module => {\n        if (typeof module.default === 'function') {\n            module.default(app)\n        }\n    })\n}`\n\n    return {\n        name: 'vite-plugin-use-modules',\n        resolveId(id) {\n            if (id === virtualModuleId) {\n                return resolvedVirtualModuleId\n            }\n        },\n        load(id) {\n            if (id === resolvedVirtualModuleId) {\n                return code\n            }\n        }\n    }\n}\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"export default () => {\n    const virtualModuleId = 'virtual:modules'\n    const resolvedVirtualModuleId = '\\0' + virtualModuleId\n\n    const code = `\nexport const modules = import.meta.globEager(\n    '/src/modules/**/*.js'\n)\n\nexport const useModules = app => {\n    Object.values(modules).forEach(module => {\n        if (typeof module.default === 'function') {\n            module.default(app)\n        }\n    })\n}`\n\n    return {\n        name: 'vite-plugin-use-modules',\n        resolveId(id) {\n            if (id === virtualModuleId) {\n                return resolvedVirtualModuleId\n            }\n        },\n        load(id) {\n            if (id === resolvedVirtualModuleId) {\n                return code\n            }\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然后注册一下插件"}]},{"type":"element","tag":"code","props":{"code":"// vite.config.js\nimport { defineConfig } from 'vite'\nimport vue from '@vitejs/plugin-vue'\nimport Modules from './plugins/use-modules'\n\nexport default defineConfig({\n    plugins: [vue(), Modules()]\n})\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// vite.config.js\nimport { defineConfig } from 'vite'\nimport vue from '@vitejs/plugin-vue'\nimport Modules from './plugins/use-modules'\n\nexport default defineConfig({\n    plugins: [vue(), Modules()]\n})\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后就可以在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"main.js"}]},{"type":"text","value":" 中愉快的使用模块自动加载了"}]},{"type":"element","tag":"code","props":{"code":"import App from './App.vue'\nimport { createApp } from 'vue'\nimport { useModules } from 'virtual:modules'\n\nconst app = createApp(App)\n\nuseModules(app)\n\napp.mount('#app')\n","language":"js"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import App from './App.vue'\nimport { createApp } from 'vue'\nimport { useModules } from 'virtual:modules'\n\nconst app = createApp(App)\n\nuseModules(app)\n\napp.mount('#app')\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"实现","src":"/quick/img/useModules.gif"},"children":[]}]}]},"_type":"markdown","_id":"content:3.vite:1.plugins:2.use-modules.md","_source":"content","_file":"3.vite/1.plugins/2.use-modules.md","_extension":"md"}]